server:
  port: ${SERVER_PORT:8081}
  servlet:
    context-path: /
  compression:
    enabled: true
    mime-types: application/json,text/html,text/css,application/javascript

spring:
  application:
    name: qt-platform
  profiles:
    active: dev

  # Jackson
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Shanghai
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false

  # 文件上传
  servlet:
    multipart:
      max-file-size: 1024MB
      max-request-size: 1100MB

  # 数据库
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:qt_platform}
    username: ${DB_USER:qt_user}
    password: ${DB_PASSWORD:qt_dev_password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      max-lifetime: 600000
      connection-timeout: 30000

  # JPA
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # Redis
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      lettuce:
        pool:
          max-active: 16
          max-idle: 8
          min-idle: 4

  # 邮件
  mail:
    host: ${MAIL_HOST:smtp.example.com}
    port: ${MAIL_PORT:465}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          ssl:
            enable: true
          starttls:
            enable: false

# MyBatis-Plus
mybatis-plus:
  mapper-locations: classpath*:mapper/**/*.xml
  type-aliases-package: com.qtplatform.*.entity
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: true
      logic-not-delete-value: false

# JWT 配置
jwt:
  secret: ${JWT_SECRET:dev-only-secret-key-must-be-changed-in-production-64chars-long-xxx}
  access-expiration: ${JWT_ACCESS_EXPIRATION:7200}
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800}

# 文件存储
storage:
  upload-path: ${UPLOAD_PATH:./uploads}
  max-file-size: ${MAX_FILE_SIZE:1073741824}
  allowed-extensions:
    - exe
    - zip
    - 7z
    - tar.gz
    - dmg
    - AppImage
    - msi
    - deb
    - rpm

# OAuth
oauth:
  github:
    client-id: ${GITHUB_CLIENT_ID:}
    client-secret: ${GITHUB_CLIENT_SECRET:}
    redirect-uri: ${GITHUB_REDIRECT_URI:http://localhost:5173/oauth/github/callback}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true

# SpringDoc
springdoc:
  api-docs:
    enabled: true
  swagger-ui:
    enabled: true
    path: /swagger-ui.html

# 限流配置
rate-limit:
  login:
    attempts-per-minute: 5
    lockout-duration-minutes: 15
  register:
    attempts-per-hour-per-ip: 10
  verification-code:
    attempts-per-minute-per-email: 1
    attempts-per-hour-per-email: 10
  upload:
    requests-per-hour: 50

# 日志级别
logging:
  level:
    root: INFO
    com.qtplatform: DEBUG
    org.springframework.security: WARN
